# wikitabia-telegram-bot
Telegram Bot проекта Wikitabia - @wikitabia_bot.

## Эпилог
Стажировочный проект компании Интабия. 
Приглашаются все желающие попробовать свои силы в OpenSource разработке, 
получить обратную связь от профессиональных разработчиков, составить себе
обьектитвное портфолио к резюме начинающего Java-разработчика. С чего начать смотри [тут](./CONTRIBUTING.md).

## О чём проект
Telegram Bot для сохранения полезных ссылок на технические материалы 
с возможностью маркировать ссылку некоторым тэгом и в дальнейшем получать по тэгам
полезные материалы.

## Что уже можем

Сервер telegram бота, который по некоторому расписанию отслеживает команды пользователя:
1) Добавить ссылку
2) Добавить тэги на ссылку
3) Просматривать добавленные ссылки

## Видение развития проекта

1) Стабилизировать первую рабочию версию проекта для разворачивания полноценного продакшен-реди сервера
2) Реализовать веб часть для администрирования добавляемых материалов
3) Настроить правила модерации материалов и участников с их уровнем доступа. Ограничить возможность добавления материалов только для ответсвенных участников и открыть доступ к материалам для всех.
4) Открыть развёрнутое продакшен решение для всех
5) Развивать продукт по обратной свзяи от пользователей

## Как собрать и запустить

Подготовь окружение:
1) Jdk 11
2) Maven 3

Собери проект
1) `maven clean install`

Запусти
1) Добавь в ресурсах токен тестового telegram бота. Параметр `application.token`.
2) `java -jar wikibot-1.0-SNAPSHOT.jar`

# CI/CD
## Как проверить, что после моих изменений ничего не сломалось

1) На проекте настроен CI/CD с помощью `Github Action`. С помощью него автоматически проходят тесты. Вам достаточно добиться зеленой галочки около вашего `pull request` - это означает, что все работает корректно.
 Если вы хотите добавить новую переменную и не знаете как это себя поведет на кластере, то вы можете у себя настроить GitHub Action самостоятельно, для этого вам нужно определить следующие переменные

| Переменная                    | Описание                                                           |
|-------------------------------|--------------------------------------------------------------------|
| DOCKER_REGISTRY_URL           | URL до докер репозитория, куда будет пушиться docker-image         |
| DOCKER_REGISTRY_LOGIN         | Логин для авторизации в докер репозиторий с правами для push/pull  |
| DOCKER_REGISTRY_PASS          | Пароль для авторизации в докер репозиторий с правами для push/pull |
| DOCKER_REGISTRY_IMAGE         | имя docker-image                                                   |
| DOCKER_REGISTRY_IMAGE_TAG_DEV | тег docker-image                                                   |
| DEV_HOST                      | ip хоста, на котором располгается стенд                            |
| DEV_HOST_USER                 | пользователь от хоста, на котором располгается стенд               |
| DEV_HOST_PASSWORD             | пароль от пользователя хоста, на котором располгается стенд        |
| APPLICATION_TOKEN             | Токен от телеграмма                                                |
| WIKITABIA_BOT_OUTER_PORT      | Порт, на котором развернется сервер бота                           |

#### Требование к хосту для развертывания
* Доступ по SSH с password flow для входа (не по shh key!)
* Уставленный docker с плагином docker compose (без дефиса v2.0+)
* Минимум 2cpu/4ram 50Gb HDD

## Добавление новых переменных среды
Если вы хотите добавить новую переменную среды, то необходимо
1) Добавить ее в application.properties через 
```shell
new.inner.property=${NEW_PROPERTY_NAME}
```
2) Добавить ее в github/workflows/di.yaml на стадии deploy через колманду
```shell
echo NEW_PROPERTY_NAME=${{secrets.NEW_PROPERTY_NAME}} >> wikibot/deployment/.env
```
3) В pull request оставьте комментарий с необходимостью добавить в переменные среды новую переменную `NEW_PROPERTY_NAME`
4) Добавьте в секцию CI/CD описание новой переменной в таблицу

